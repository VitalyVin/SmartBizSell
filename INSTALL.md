# Инструкция по установке SmartBizSell

## Требования

- PHP 7.4 или выше
- MySQL 8.0 / Percona Server 8.0
- Веб-сервер (Apache/Nginx)
- PDO расширение для PHP
- Хостинг reg.ru (или другой с поддержкой MySQL 8.0)

## Быстрая установка на reg.ru

### 1. Подготовка базы данных

1. Войдите в панель управления reg.ru
2. Перейдите в раздел "Базы данных MySQL"
3. Убедитесь, что у вас есть база данных MySQL 8.0 (Percona Server)
4. Запомните следующие данные:
   - **Имя базы данных** (например, `u3064951_default`)
   - **Имя пользователя** (например, `u3064951_default`)
   - **Пароль** от базы данных
   - **Хост** (обычно `localhost`)

### 2. Импорт структуры базы данных

**Через phpMyAdmin (рекомендуется):**

1. Откройте phpMyAdmin в панели управления reg.ru
2. Выберите вашу базу данных в левом меню
3. Перейдите на вкладку **"SQL"**
4. Откройте файл `db/schema.sql` в текстовом редакторе
5. Скопируйте содержимое файла (начиная с `CREATE TABLE IF NOT EXISTS users`)
6. Вставьте SQL-код в окно phpMyAdmin
7. Нажмите **"Вперед"** (Execute)

**Или через импорт:**

1. В phpMyAdmin выберите вашу базу данных
2. Перейдите на вкладку **"Импорт"**
3. Нажмите **"Выбрать файл"** и выберите `db/schema.sql`
4. Нажмите **"Вперед"**

После успешного импорта будут созданы 3 таблицы:
- `users` - пользователи (продавцы)
- `seller_forms` - анкеты продавцов
- `user_sessions` - сессии пользователей (опционально)

### 3. Настройка конфигурации

1. Скопируйте файл `config.php.example` в `config.php`:
   ```bash
   cp config.php.example config.php
   ```

2. Откройте `config.php` и обновите следующие параметры:

```php
// Настройки подключения к MySQL
define('DB_HOST', 'localhost'); // Обычно localhost для reg.ru
define('DB_NAME', 'u3064951_default'); // Имя вашей базы данных
define('DB_USER', 'u3064951_default'); // Имя пользователя БД
define('DB_PASS', 'ваш_пароль_от_БД'); // Пароль от базы данных
define('DB_CHARSET', 'utf8mb4'); // UTF-8 Unicode

// Пути
define('BASE_URL', 'https://smartbizsell.ru'); // Ваш домен
define('ADMIN_EMAIL', 'admin@smartbizsell.ru'); // Email администратора
```

**Важно:** Файл `config.php` содержит пароли и не должен попадать в git репозиторий. Он уже добавлен в `.gitignore`.

### 4. Загрузка файлов на сервер

Загрузите все файлы проекта на ваш хостинг через FTP/SFTP или файловый менеджер reg.ru:

```
/
├── config.php (создайте из config.php.example)
├── index.php
├── dashboard.php
├── login.php
├── register.php
├── logout.php
├── script.js
├── styles.css
├── .htaccess
└── db/
    └── schema.sql
```

### 5. Настройка прав доступа

Убедитесь, что файлы имеют правильные права доступа:

```bash
chmod 644 config.php
chmod 644 *.php
chmod 644 *.js
chmod 644 *.css
chmod 755 db/
```

### 6. Проверка установки

1. Откройте в браузере страницу регистрации:
   ```
   https://ваш-домен.ru/register.php
   ```

2. Если страница загружается без ошибок - подключение к БД настроено правильно.

3. Попробуйте зарегистрировать тестового пользователя.

4. Войдите в систему и проверьте личный кабинет.

## Структура файлов

### Основные файлы:

- `config.php` - Конфигурация БД и функции (создается из `config.php.example`)
- `config.php.example` - Шаблон конфигурации (без паролей)
- `index.php` - Главная страница с формой анкеты
- `register.php` - Страница регистрации
- `login.php` - Страница входа
- `logout.php` - Выход из системы
- `dashboard.php` - Личный кабинет продавца
- `script.js` - JavaScript функциональность
- `styles.css` - Стили оформления
- `.htaccess` - Настройки Apache

### База данных:

- `db/schema.sql` - SQL скрипт для создания структуры БД
- `db/README.md` - Дополнительная документация по БД

## Функциональность

### Для продавцов:

1. **Регистрация** - создание аккаунта с email и паролем
2. **Вход** - авторизация в системе
3. **Личный кабинет** - просмотр всех отправленных анкет
4. **Отправка анкет** - заполнение и сохранение анкет в БД
5. **Отслеживание статуса** - просмотр статуса анкет:
   - Черновик
   - Отправлена
   - На проверке
   - Одобрена
   - Отклонена

### Безопасность:

- ✅ Пароли хешируются с использованием bcrypt (cost 12)
- ✅ Защита от SQL-инъекций через PDO prepared statements
- ✅ Санитизация всех пользовательских данных
- ✅ Защищенные сессии с httponly cookies
- ✅ Валидация всех входных данных
- ✅ `config.php` исключен из git через `.gitignore`

## Информация о сервере

### Для reg.ru:

- **Сервер**: MySQL 8.0 (Percona Server)
- **Хост**: localhost (via UNIX socket)
- **Кодировка**: UTF-8 Unicode (utf8mb4)
- **SSL**: Не используется для localhost подключений

Percona Server 8.0 полностью совместим с MySQL 8.0, все функции работают корректно.

## Устранение неполадок

### Ошибка подключения к БД

**Симптомы:** Страница не загружается, ошибка "Database connection error"

**Решение:**
1. Проверьте правильность данных в `config.php`:
   - Имя базы данных
   - Имя пользователя
   - Пароль
   - Хост (обычно `localhost`)
2. Убедитесь, что база данных существует
3. Проверьте, что пользователь имеет права на базу данных
4. Проверьте логи ошибок PHP

### Ошибка "Table doesn't exist"

**Симптомы:** Ошибка при попытке зарегистрироваться или войти

**Решение:**
1. Выполните SQL скрипт из `db/schema.sql` для создания таблиц
2. Убедитесь, что вы выбрали правильную базу данных в phpMyAdmin
3. Проверьте, что все таблицы созданы (users, seller_forms, user_sessions)

### Сессии не работают

**Симптомы:** После входа сразу выкидывает, не запоминает пользователя

**Решение:**
1. Убедитесь, что PHP сессии включены
2. Проверьте, что папка для сессий доступна для записи
3. В `config.php` проверьте настройки сессий
4. Для HTTPS сайтов убедитесь, что `session.cookie_secure` установлен правильно

### Ошибка "Call to undefined function"

**Симптомы:** Ошибка при загрузке страницы

**Решение:**
1. Убедитесь, что файл `config.php` существует
2. Проверьте, что все файлы загружены на сервер
3. Проверьте пути к файлам в `require_once`

### Проблемы с кодировкой

**Симптомы:** Кракозябры вместо русских букв

**Решение:**
1. Убедитесь, что база данных использует кодировку `utf8mb4`
2. Проверьте, что в `config.php` указано `DB_CHARSET = 'utf8mb4'`
3. Убедитесь, что файлы PHP сохранены в кодировке UTF-8

## Дополнительная информация

### Логи ошибок

Для отладки проверьте логи ошибок:
- Логи PHP обычно находятся в `/var/log/php/` или в панели управления хостингом
- Логи MySQL в панели управления reg.ru

### Обновление

При обновлении проекта:
1. Сделайте резервную копию базы данных
2. Сделайте резервную копию `config.php`
3. Загрузите новые файлы
4. Восстановите `config.php` из резервной копии
5. При необходимости выполните миграции БД

### Резервное копирование

Рекомендуется регулярно делать резервные копии:
- База данных (через phpMyAdmin → Экспорт)
- Файл `config.php`
- Все файлы проекта

## Поддержка

При возникновении проблем:
1. Проверьте логи ошибок PHP и MySQL
2. Убедитесь, что все шаги установки выполнены правильно
3. Проверьте документацию в `db/README.md`

---

**Версия:** 1.0  
**Дата обновления:** 2025
